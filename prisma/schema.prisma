generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id String @id @default(uuid())

  email         String  @unique
  password      String
  isTotpEnabled Boolean @default(false) @map("is_totp_enabled")
  totpSecret    String? @map("totp_secret")

  profileInfo      ProfileInfo?
  userRole         UserRole[]
  notification     Notification[]
  hostVefification HostVefification?
  listing          Listing[]

  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  hostVefificationId String?

  @@map("users")
}

model ProfileInfo {
  id String @id @default(uuid())

  name      String
  avatarUrl String? @map("avatar_url")
  aboutMe   String?
  birthday  String

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique @map("user_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("profile_infos")
}

model UserRole {
  id String @id @default(uuid())

  roleType UserRoleType @default(USER)

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @map("user_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user_roles")
}

model Notification {
  id String @id @default(uuid())

  notificationType NotificationType @default(INFO) @map("notification_type")
  title            String
  description      String
  isRead           Boolean          @default(false) @map("is_read")

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("notifications")
}

model HostVefification {
  id String @id @default(uuid())

  verificationStatus HostVerificationStatusType @default(PENDING) @map("verification_status")
  message            String?

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique @map("user_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("host_verifications")
}

model Listing {
  id String @id @default(uuid())

  title        String
  description  String
  imageUrl     String[]     @map("image_urls")
  propertyType PropertyType @default(APARTAMENT) @map("property_type")

  country String
  city    String
  lat     Float
  lng     Float

  price           Int
  discountPercent Int @default(0) @map("discount_percent")

  bedCount  Int @default(1) @map("bed_count")
  bathCount Int @default(1) @map("bath_count")
  roomCount Int @default(1) @map("room_count")

  amenities String[]

  listingStatus ListingStatusType     @default(PENDING) @map("listing_status")
  verification  ListingVerification[]

  host   User   @relation(fields: [hostId], references: [id], onDelete: Cascade)
  hostId String

  // Comments
  // Rating

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([city, country])
  @@index([listingStatus])
  @@map("listings")
}

model ListingVerification {
  id String @id @default(uuid())

  verificationStatus ListingStatusType @default(PENDING) @map("verification_status")
  message            String?

  Listing   Listing @relation(fields: [listingId], references: [id], onDelete: Cascade)
  listingId String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("listing_verifications")
}

enum UserRoleType {
  USER
  HOST
  ADMIN
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum HostVerificationStatusType {
  PENDING
  APPROVED
  REJECT
}

enum ListingStatusType {
  PENDING
  PUBLISHED
  REJECT
  BANNED
}

enum PropertyType {
  APARTAMENT
  HOUSE
  HOTEL
  ROOM
}
